name: Deploy Staging
on:
  push:
    tags:
      - v*.*.*
    branches: 
      - master

jobs:
  build:
    name: Build App
    runs-on: ubuntu-latest
    steps:
      - name: Build
        run: echo BUILD_OK
  
  test:
    name: Test App
    runs-on: ubuntu-latest
    steps:
      - name: Test
        run: echo TEST_OK

  push:
    name: Push Image
    runs-on: ubuntu-latest
    steps:
      - name: Docker Build
        run: echo DOCKER_BUILD_OK

      - name: Docker Push to Registry
        run: echo DOCKER_PUSH_OK
  
  deploy:
    name: Deploy Staging
    runs-on: ubuntu-latest
    needs: [build, test, push]
    steps:
      - name: Install Kubectl
        run: echo KUBECTL_OK
      
      - name: Install Helm
        run: echo KUBECTL_OK
      
      - name: Helm Upgrade
        run: echo HELM_UPGRADE_OK
